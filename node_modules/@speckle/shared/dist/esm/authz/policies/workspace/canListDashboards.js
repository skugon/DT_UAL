import { err, ok } from 'true-myth/result';
import { WorkspaceNotEnoughPermissionsError } from '../../domain/authErrors.js';
import { ensureDashboardsEnabledFragment, ensureWorkspaceDashboardsFeatureAccessFragment } from '../../fragments/dashboards.js';
import { hasMinimumWorkspaceRole } from '../../checks/workspaceRole.js';
import { Roles } from '../../../core/constants.js';
export const canListDashboardsPolicy = (loaders) => async ({ userId, workspaceId }) => {
    const isDashboardsEnabled = await ensureDashboardsEnabledFragment(loaders)({});
    if (isDashboardsEnabled.isErr)
        return err(isDashboardsEnabled.error);
    const ensuredFeatureAccess = await ensureWorkspaceDashboardsFeatureAccessFragment(loaders)({ workspaceId });
    if (ensuredFeatureAccess.isErr)
        return err(ensuredFeatureAccess.error);
    const isWorkspaceMember = await hasMinimumWorkspaceRole(loaders)({
        userId: userId,
        workspaceId,
        role: Roles.Workspace.Member
    });
    if (!isWorkspaceMember)
        return err(new WorkspaceNotEnoughPermissionsError());
    return ok();
};
//# sourceMappingURL=canListDashboards.js.map