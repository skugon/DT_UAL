"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.canListDashboardsPolicy = void 0;
const result_1 = require("true-myth/result");
const authErrors_js_1 = require("../../domain/authErrors.js");
const dashboards_js_1 = require("../../fragments/dashboards.js");
const workspaceRole_js_1 = require("../../checks/workspaceRole.js");
const constants_js_1 = require("../../../core/constants.js");
const canListDashboardsPolicy = (loaders) => async ({ userId, workspaceId }) => {
    const isDashboardsEnabled = await (0, dashboards_js_1.ensureDashboardsEnabledFragment)(loaders)({});
    if (isDashboardsEnabled.isErr)
        return (0, result_1.err)(isDashboardsEnabled.error);
    const ensuredFeatureAccess = await (0, dashboards_js_1.ensureWorkspaceDashboardsFeatureAccessFragment)(loaders)({ workspaceId });
    if (ensuredFeatureAccess.isErr)
        return (0, result_1.err)(ensuredFeatureAccess.error);
    const isWorkspaceMember = await (0, workspaceRole_js_1.hasMinimumWorkspaceRole)(loaders)({
        userId: userId,
        workspaceId,
        role: constants_js_1.Roles.Workspace.Member
    });
    if (!isWorkspaceMember)
        return (0, result_1.err)(new authErrors_js_1.WorkspaceNotEnoughPermissionsError());
    return (0, result_1.ok)();
};
exports.canListDashboardsPolicy = canListDashboardsPolicy;
//# sourceMappingURL=canListDashboards.js.map